/*! fmd.js v0.2.0 | http://fmdjs.org/ | MIT */
(function(f){if(!f.fmd){var g={},l=[],b=function(a){return g[a]},a=function(a,b,c){if(!g[a]){c||(c=b,b=[]);if("function"===typeof c){for(var k=[],e=0,f=b.length;e<f;e++)k.push(g[b[e]]);c=c.apply(null,k)}g[a]=c||1;l.push(a)}};a.version="0.2.0";a.cache={parts:l};a("global",f);a("require",function(){return b});a("env",function(){return a});a("cache",function(){return a.cache});f.fmd=a}})(this);
fmd("lang",function(){var f={}.toString,g=Array.prototype,l={isFunction:function(b){return"[object Function]"===f.call(b)},isArray:Array.isArray||function(b){return"[object Array]"===f.call(b)},isString:function(b){return"string"===typeof b},forEach:g.forEach?function(b,a,h){b.forEach(a,h)}:function(b,a,h){for(var d=0,c=b.length;d<c;d++)a.call(h,b[d],d,b)},map:g.map?function(b,a,h){return b.map(a,h)}:function(b,a,h){var d=[];l.forEach(b,function(c,b,e){d.push(a.call(h,c,b,e))});return d},inArray:g.indexOf?
function(b,a){return b.indexOf(a)}:function(b,a){for(var h=0,d=b.length;h<d;h++)if(b[h]===a)return h;return-1}};return l});fmd("event",["env","cache"],function(f,g){var l=g.events={},b=[].slice,a={on:function(a,b){(l[a]||(l[a]=[])).push(b)},emit:function(a){var d=b.call(arguments,1),c=l[a],k,e=0;if(c)for(;k=c[e++];)k.apply(null,d)},off:function(a,b){var c=l[a];if(c)if(b)for(var k=c.length-1;0<=k;k--)c[k]===b&&c.splice(k,1);else delete l[a]}};f.on=a.on;f.off=a.off;return a});
fmd("config",["env","cache","lang"],function(f,g,l){var b=g.config={},a=g.configRules={},h=0,d={get:function(a){return b[a]},set:function(c){for(var k in c){var e=c[k],d=b[k],m=k,p=e,f=!1,g=void 0,h=void 0;for(h in a)if(f)break;else g=a[h],f=-1<l.inArray(g.keys,m)&&void 0===g.rule.call(b,d,m,p);f||(b[k]=e)}},register:function(c){var b;l.isFunction(c.rule)&&(c.name||(c.name="_rule_"+h++),b=a[c.name]={rule:c.rule,keys:[]});b||(b=a[c.name]);b&&c.keys&&(l.isArray(c.keys)?b.keys=b.keys.concat(c.keys):
b.keys.push(c.keys));return this}};d.register({name:"object",rule:function(a,b,e){if(a)for(var d in e)a[d]=e[d];else return!1}}).register({name:"array",rule:function(a,b,e){a?a.push(e):this[b]=[e]}});f.config=function(a){if(l.isString(a))return d.get(a);d.set(a)};return d});
fmd("module",["global","env","cache","lang","event"],function(f,g,l,b,a){var h=[],d=0,c=l.modules={},k={require:function(b){b.require||e.makeRequire(b);a.emit("makeRequire",b.require,b);return b.require},exports:function(a){return a.exports},module:function(a){a.module={id:a.id,exports:a.exports};return a.module}},e=function(a,b,c){this.id=a;this.deps=b||[];this.factory=c;this.exports={};this.unnamed()&&(a="_!_fmd_anonymous_"+d,d++);this.uid=a};e.prototype={unnamed:function(){return""===this.id},
extract:function(){var a=this,c=a.deps,d=[];b.isArray(c)&&b.forEach(c,function(b){var c;(c=k[b])?b=c(a):(a.require||e.makeRequire(a),b=a.require(b));d.push(b)});return d},compile:function(){try{if(b.isFunction(this.factory)){var c=this.extract(),e=this.factory.apply(null,c);void 0!==e?this.exports=e:this.module&&this.module.exports&&(this.exports=this.module.exports);this.module&&delete this.module}else void 0!==this.factory&&(this.exports=this.factory);a.emit("compiled",this)}catch(d){a.emit("compileFailed",
d,this)}},autocompile:function(){this.unnamed()&&this.compile()}};e.get=function(a){return c[a]};e.has=function(b,e){if(k[b])return!0;var d={id:b};e&&a.emit("alias",d);return c[d.id]?!0:!1};e.save=function(b){c[b.uid]=b;a.emit("saved",b);b.autocompile()};e.require=function(b){var c=e.get(b);if(!c)return a.emit("requireFailed",{id:b}),null;c.compiled||(c.compiled=!0,c.compile());a.emit("required",c);return c.exports};e.makeRequire=function(b){b.require=function(c){c={id:c};a.emit("relative",c,b);a.emit("alias",
c);return e.require(c.id)}};e.define=function(c,d,k){var f=arguments.length;1===f?(k=c,c=""):2===f&&(k=d,d=h,b.isString(c)||(d=c,c=""));if(e.has(c,!0))return a.emit("existed",{id:c}),null;e.save(new e(c,d,k))};var n=f.define;g.noConflict=function(){f.define=n};g.define=f.define=e.define;return e});
fmd("relative",["lang","event","module"],function(f,g,l){var b=/.*\//,a=/\/\.\//,h=/[^\/]+\/\.\.\//,d={cwd:function(a){return a.match(b)[0]},isDotStart:function(a){return"."===a.charAt(0)},hasSlash:function(a){return 0<a.lastIndexOf("/")},resolve:function(b,d){for(var e=(b+d).replace(a,"/");e.match(h);)e=e.replace(h,"");return e}};g.on("relative",function(a,b){d.isDotStart(a.id)&&(b&&d.hasSlash(b.id))&&(b._cwd||(b._cwd=d.cwd(b.id)),a.id=d.resolve(b._cwd,a.id))});return d});
fmd("alias",["config","event"],function(f,g){f.register({keys:"alias",name:"object"});g.on("alias",function(g){var b=f.get("alias"),a;b&&(a=b[g.id])&&(g.id=a)})});
