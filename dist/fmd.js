/*! fmd.js v0.2.1 | http://fmdjs.org/ | MIT */
(function(f){if(!f.fmd){var g={},e=[],c=function(a){return g[a]},d=function(a,b,h){if(!g[a]){h||(h=b,b=[]);if("function"===typeof h){for(var d=[],c=0,f=b.length;c<f;c++)d.push(g[b[c]]);h=h.apply(null,d)}g[a]=h||1;e.push(a)}};d.version="0.2.1";d.cache={parts:e};d("global",f);d("require",function(){return c});d("env",function(){return d});d("cache",function(){return d.cache});f.fmd=d}})(this);
fmd("lang",function(){var f={}.toString,g=Array.prototype,e={isFunction:function(c){return"[object Function]"===f.call(c)},isArray:Array.isArray||function(c){return"[object Array]"===f.call(c)},isString:function(c){return"string"===typeof c},forEach:g.forEach?function(c,d,a){c.forEach(d,a)}:function(c,d,a){for(var b=0,h=c.length;b<h;b++)d.call(a,c[b],b,c)},map:g.map?function(c,d,a){return c.map(d,a)}:function(c,d,a){var b=[];e.forEach(c,function(h,c,e){b.push(d.call(a,h,c,e))});return b},inArray:g.indexOf?
function(c,d){return c.indexOf(d)}:function(c,d){for(var a=0,b=c.length;a<b;a++)if(c[a]===d)return a;return-1}};return e});fmd("event",["env","cache"],function(f,g){var e=g.events={},c=[].slice,d={on:function(a,b){(e[a]||(e[a]=[])).push(b)},emit:function(a){var b=c.call(arguments,1),h=e[a],d,k=0;if(h)for(;d=h[k++];)d.apply(null,b)},off:function(a,b){var h=e[a];if(h)if(b)for(var d=h.length-1;0<=d;d--)h[d]===b&&h.splice(d,1);else delete e[a]}};f.on=d.on;f.off=d.off;return d});
fmd("config",["env","cache","lang"],function(f,g,e){var c=g.config={},d=g.configRules={},a=0,b={get:function(a){return c[a]},set:function(a){for(var b in a){var k=a[b],g=c[b],m=b,p=k,f=!1,q=void 0,r=void 0;for(r in d)if(f)break;else q=d[r],f=-1<e.inArray(q.keys,m)&&void 0===q.rule.call(c,g,m,p);f||(c[b]=k)}},register:function(b){var c;e.isFunction(b.rule)&&(b.name||(b.name="_rule_"+a++),c=d[b.name]={rule:b.rule,keys:[]});c||(c=d[b.name]);c&&b.keys&&(e.isArray(b.keys)?c.keys=c.keys.concat(b.keys):
c.keys.push(b.keys));return this}};b.register({name:"object",rule:function(a,b,d){if(a)for(var c in d)a[c]=d[c];else return!1}}).register({name:"array",rule:function(a,b,d){a?a.push(d):this[b]=[d]}});f.config=function(a){if(e.isString(a))return b.get(a);b.set(a)};return b});
fmd("module",["global","env","cache","lang","event"],function(f,g,e,c,d){var a=[],b=0,h=e.modules={},l={require:function(a){a.require||k.makeRequire(a);d.emit("makeRequire",a.require,a);return a.require},exports:function(a){return a.exports},module:function(a){a.module={id:a.id,exports:a.exports};return a.module}},k=function(a,d,c){this.id=a;this.deps=d||[];this.factory=c;this.exports={};this.unnamed()&&(a="_!_fmd_anonymous_"+b,b++);this.uid=a};k.prototype={unnamed:function(){return""===this.id},
extract:function(){var a=this,b=a.deps,d=[];c.isArray(b)&&c.forEach(b,function(b){var c;(c=l[b])?b=c(a):(a.require||k.makeRequire(a),b=a.require(b));d.push(b)});return d},compile:function(){try{if(c.isFunction(this.factory)){var a=this.extract(),b=this.factory.apply(null,a);void 0!==b?this.exports=b:this.module&&this.module.exports&&(this.exports=this.module.exports);this.module&&delete this.module}else void 0!==this.factory&&(this.exports=this.factory);d.emit("compiled",this)}catch(h){d.emit("compileFailed",
h,this)}},autocompile:function(){this.unnamed()&&this.compile()}};k.get=function(a){return h[a]};k.has=function(a,b){if(l[a])return!0;var c={id:a};b&&d.emit("alias",c);return h[c.id]?!0:!1};k.save=function(a){h[a.uid]=a;d.emit("saved",a);a.autocompile()};k.require=function(a){var b=k.get(a);if(!b)return d.emit("requireFailed",{id:a}),null;b.compiled||(b.compiled=!0,b.compile());d.emit("required",b);return b.exports};k.makeRequire=function(a){a.require=function(b){b={id:b};d.emit("relative",b,a);d.emit("alias",
b);return k.require(b.id)}};k.define=function(b,h,e){var g=arguments.length;1===g?(e=b,b=""):2===g&&(e=h,h=a,c.isString(b)||(h=b,b=""));if(k.has(b,!0))return d.emit("existed",{id:b}),null;k.save(new k(b,h,e))};k.define.fmd={};var n=f.define;g.noConflict=function(){f.define=n};g.define=f.define=k.define;return k});
fmd("relative",["lang","event","module"],function(f,g,e){var c=/.*\//,d=/\/\.\//,a=/[^\/]+\/\.\.\//,b={cwd:function(a){return a.match(c)[0]},isDotStart:function(a){return"."===a.charAt(0)},hasSlash:function(a){return 0<a.lastIndexOf("/")},resolve:function(b,c){for(var e=(b+c).replace(d,"/");e.match(a);)e=e.replace(a,"");return e}};g.on("relative",function(a,d){b.isDotStart(a.id)&&(d&&b.hasSlash(d.id))&&(d._cwd||(d._cwd=b.cwd(d.id)),a.id=b.resolve(d._cwd,a.id))});return b});
fmd("alias",["config","event"],function(f,g){f.register({keys:"alias",name:"object"});g.on("alias",function(e){var c=f.get("alias"),d;c&&(d=c[e.id])&&(e.id=d)})});
fmd("id2url",["global","event","config"],function(f,g,e){var c=/^https?:\/\//i,d=(new Date).getTime();e.set({baseUrl:function(){var a=f.document.getElementsByTagName("script"),a=a[a.length-1];return(a.hasAttribute?a.src:a.getAttribute("src",4)).match(/(?:[\w]+)\:\/\/(?:[\w|\.|\:]+)\//i)[0]}()});e.register({keys:"resolve",name:"array"}).register({keys:"stamp",name:"object"});g.on("resolve",function(a){var b=e.get("resolve"),d;if(b)for(var c=0,g=b.length;c<g&&(d=b[c](a.id),d===a.id);c++);a.url=d?d:
a.id});g.on("stamp",function(a){var b=e.get("hasStamp")?d:null,c=e.get("stamp");if(c)for(var g in c)if(RegExp(g).test(a.id)){b=c[g];break}b&&(a.url+="?fmd.stamp="+b)});g.on("id2url",function(a){g.emit("resolve",a);c.test(a.url)||(a.url=e.get("baseUrl")+a.url);var b=a.url;b.lastIndexOf(".")<b.lastIndexOf("/")&&(a.url+=".js");g.emit("stamp",a)})});
fmd("assets",["cache","lang","event","config","module"],function(f,g,e,c,d){var a=f.assets={},b={},h={make:function(c,g){var h={id:c};e.emit("analyze",h);e.emit("relative",h,g);e.emit("alias",h);if(b[h.id])return a[b[h.id]];d.has(h.id)?h.url=h.id:e.emit("id2url",h);b[h.id]=h.url;return a[h.url]=h},group:function(a){return g.map(a.deps,function(b){return h.make(b,a)})}};return h});
fmd("when",function(){var f=function(){},g=function(e){var c=this,d=[],a=0,b=0;e=e||0;var h=function(){a+b===e&&g()},g=function(){c.then=b?function(a,b){b&&b()}:function(a,b){a&&a()};g=f;k(b?1:0);k=f;d=[]},k=function(a){for(var b,c=0;b=d[c++];)(b=b[a])&&b()};this.then=function(a,b){d.push([a,b])};this.resolve=function(){a++;h()};this.reject=function(){b++;h()};h()};return function(){for(var e=new g(arguments.length),c,d=0;c=arguments[d++];)c(e);return e}});
fmd("request",["global","config","event"],function(f,g,e){var c=f.document,d=f.setTimeout,a=/\.css(?:\?|$)/i,b=/loaded|complete/,h=/security|denied/i,l=536>1*f.navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1"),k=c&&(c.head||c.getElementsByTagName("head")[0]||c.documentElement),n=function(a,b,c){var g=!1,f,k;try{if(f=a.sheet)g=(k=f.cssRules)?0<k.length:void 0!==k}catch(l){g=h.test(l.message)}d(function(){g?(b&&b(),e.emit("requested",c)):n(a,b,c)},20)},m=function(a,c,d,h,f){function k(){a.onload=
a.onreadystatechange=a.onerror=null;f||g.get("debug")||a.parentNode&&a.parentNode.removeChild(a);a=void 0;c&&c()}d?(a.onload=function(){k();e.emit("requested",h)},a.onerror=function(){k();e.emit("requestError",h)}):a.onreadystatechange=function(){b.test(a.readyState)&&(k(),e.emit("requested",h))}},p=function(a,b,c,e){l||!c?d(function(){n(a,b,e)},1):m(a,b,c,e,!0)};return function(b,d){var h=a.test(b.url),f;h?(f=c.createElement("link"),f.rel="stylesheet",f.href=b.url):(f=c.createElement("script"),f.async=
!0,f.src=b.url);g.get("charset")&&(f.charset=g.get("charset"));e.emit("createNode",f,b);var l="onload"in f;h?p(f,d,l,b):m(f,d,l,b);k.appendChild(f)}});
fmd("loader",["global","event","config","request"],function(f,g,e,c){var d=function(){};e.set({timeout:1E4});g.on("requestComplete",function(a){var b;a.state="loaded";for(b=a.onload;a=b.shift();)a()});return function(a,b){b||(b=d);"loaded"===a.state?b():"loading"===a.state?a.onload.push(b):(a.state="loading",a.onload=[b],g.emit("request",a,b),a.requested||(a.timer=f.setTimeout(function(){g.emit("requestTimeout",a)},e.get("timeout")),c(a,function(){f.clearTimeout(a.timer);g.emit("requestComplete",
a)})))}});
fmd("remote","lang event module assets when loader".split(" "),function(f,g,e,c,d,a){var b={};b.bring=b.get=function(b,c){d.apply(null,f.map(b,function(b){return function(c){e.has(b.id)?c.resolve():a(b,function(){c.resolve()})}})).then(c)};b.fetch=function(a,l){var k=c.group(a);g.emit("fetch",k);b.bring(k,function(){d.apply(null,f.map(k,function(a){return function(c){var d=e.get(a.id);d&&!d.compiled&&d.deps.length?b.fetch(d,function(){c.resolve()}):c.resolve()}})).then(function(){l.call(null,k)})})};
return b});fmd("use",["lang","event","module","remote"],function(f,g,e,c){g.on("makeRequire",function(d,a){d.use=function(b,d){f.isArray(b)||(b=[b]);c.fetch({id:a.id,deps:b},function(a){a=f.map(a,function(a){return e.require(a.id)});d&&d.apply(null,a)})}})});
fmd("async",["config","module","remote"],function(f,g,e){var c=g.prototype.autocompile,d=function(){var a=this;a.unnamed()&&e.fetch(a,function(){a.compile()})};f.register({keys:"async",rule:function(a,b,e){e=!!e;a!==e&&(this.async=e,g.prototype.autocompile=!0===e?d:c)}}).set({async:!0})});
fmd("logger","global require env config assets loader console".split(" "),function(f,g,e,c,d,a,b){var h=e.log=function(){},l=f.console,k=function(c){e.log=c?l&&l.warn?function(a,b){l[b||"log"](a)}:function(c,e){b?b(c,e):a&&a(d.make("fmd/console"),function(){b||(b=g("console"));b(c,e)})}:h};c.register({keys:"debug",rule:function(a,b,c){k(c);this.debug=c}})});
